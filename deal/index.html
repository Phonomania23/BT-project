<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Сделка — Bloggers.tools</title>

  <!-- Стили -->
  <link rel="stylesheet" href="../css/base.css?v=20250901" />
  <link rel="stylesheet" href="../css/layout.css?v=20250901" />
  <link rel="stylesheet" href="../css/deal.css?v=20250901" />

  <!-- Небольшие правки под web-component и графики -->
  <style>
    /* чтобы web-component корректно участвовал в гриде/списке */
    .cards-list blogger-card { display:block; }
    /* спарклайны из компонента */
    .sl { width:180px; height:44px; }
    .sl path { fill:none; stroke:rgba(25,118,210,.9); stroke-width:2; }
  </style>

  <!-- Скрипты (ВАЖЕН ПОРЯДОК) -->
  <script defer src="../js/include.js?v=6"></script>
  <script defer src="../js/cards.js?v=6"></script>
  <script defer src="../js/components/blogger-card.js?v=6"></script>
  <script defer src="../js/filters.js?v=6"></script>
  <script defer src="../js/deal-router.js?v=6"></script>
</head>
<body>
  <div data-include="/components/header.html"></div>

  <div class="deal-wrap container">
    <!-- Сайдбар-воронка -->
    <aside class="deal-sidebar" aria-label="Этапы сделки">
      <nav id="dealNav" class="steps-vertical">
        <a href="#/1-pick"     data-step="1">1. Подбор</a>
        <a href="#/2-brief"    data-step="2">2. Бриф</a>
        <a href="#/3-email"    data-step="3">3. Привязка почты</a>
        <a href="#/4-outreach" data-step="4">4. Рассылка</a>
        <a href="#/5-contract" data-step="5">5. Договор</a>
        <a href="#/6-payment"  data-step="6">6. Оплата</a>
        <a href="#/7-shoot"    data-step="7">7. Съёмка</a>
        <a href="#/8-approval" data-step="8">8. Одобрение</a>
        <a href="#/9-payout"   data-step="9">9. Выплата</a>
      </nav>
    </aside>

    <!-- Контент -->
    <main class="deal-main">
      <!-- Верхние табы -->
      <div id="dealTabs" class="deal-tabs">
        <button data-step="1">Подбор</button>
        <button data-step="2">Бриф</button>
        <button data-step="3">Почта</button>
        <button data-step="4">Рассылка</button>
        <button data-step="5">Договор</button>
        <button data-step="6">Оплата</button>
        <button data-step="7">Съёмка</button>
        <button data-step="8">Одобрение</button>
        <button data-step="9">Выплата</button>
      </div>

      <!-- Хост для контента шагов -->
      <section id="stepHost" class="card" style="padding:16px"></section>

      <!-- Нижняя навигация -->
      <footer class="deal-footer row" style="justify-content:space-between">
        <button id="prevBtn" class="btn btn-secondary" type="button">Назад</button>
        <div class="muted">Этап <span id="stepNow">1</span> из 9</div>
        <button id="nextBtn" class="btn" type="button">Далее</button>
      </footer>
    </main>
  </div>

  <div data-include="/components/footer.html"></div>

  <!-- ================== ШАБЛОНЫ ШАГОВ ================== -->

  <!-- Шаг 1: Подбор (AI + расширенные фильтры + подписчики в тыс.) -->
  <template id="tpl-1-pick">
    <h2>Подбор блогеров</h2>

    <!-- Верхняя панель: AI-поиск + ручные фильтры -->
    <div class="aibar card" style="margin-bottom:12px;padding:12px">
      <div class="row" style="align-items:flex-end;gap:12px">
        <div class="field" style="flex:1;min-width:260px">
          <label>AI search (опционально)</label>
          <input id="aiQuery" type="text" placeholder="English YouTube, followers 50k–100k, ER > 4%…" />
        </div>
        <button id="aiApply" class="btn" type="button">Применить AI-запрос</button>
        <button id="aiClear" class="btn btn-secondary" type="button">Сброс</button>
      </div>
      <div class="muted" style="margin-top:6px">
        Поддерживаются фразы:
        <code>followers 10k-100k</code>, <code>ER 3-7</code>, <code>language english</code>,
        <code>country RU</code>, <code>similar to Wylsacom</code>, <code>top ER</code> и т.п.
      </div>
    </div>

    <!-- ФИЛЬТР-БАР -->
    <form id="filtersForm" class="filterbar" onsubmit="return false">
      <!-- Платформа -->
      <div class="chip">
        <label>Платформа</label>
        <select id="fPlatform">
          <option value="">Все платформы</option>
          <option>YouTube</option>
          <option>TikTok</option>
          <option>Instagram</option>
          <option>Telegram</option>
        </select>
      </div>

      <!-- Подписчики (тыс.) -->
      <div class="chip">
        <label>Подписчики (тыс.)</label>
        <input id="followersMinK" type="number" min="0" step="1" placeholder="от" style="width:90px" />
        <span class="muted">—</span>
        <input id="followersMaxK" type="number" min="0" step="1" placeholder="до" style="width:90px" />
      </div>

      <!-- Рубрика -->
      <div class="chip">
        <label>Рубрика</label>
        <input id="fCategory" type="text" placeholder="техника, красота…" />
      </div>

      <!-- Демография (аудитория) -->
      <div class="chip">
        <label>Audience geo</label>
        <select id="fGeo">
          <option value="">Любая</option>
          <option>RU</option><option>KZ</option><option>BY</option>
          <option>UA</option><option>GE</option><option>TR</option>
        </select>
        <input id="fGeoShare" type="number" min="0" max="100" step="5" value="0" title="% аудитории" style="width:76px" />
        <span class="muted">%</span>
      </div>

      <div class="chip">
        <label>Audience gender</label>
        <select id="fGender">
          <option value="">Любой</option>
          <option value="female">Преимущественно женщины</option>
          <option value="male">Преимущественно мужчины</option>
        </select>
        <span class="muted" title="по умолчанию выборка=60%">(60%)</span>
      </div>

      <div class="chip">
        <label>Audience age (мин %)</label>
        <select id="fAgeBucket">
          <option value="">Любой</option>
          <option>13-17</option><option>18-24</option><option>25-34</option>
          <option>35-44</option><option>45-64</option><option>65+</option>
        </select>
        <input id="fAgeShare" type="number" min="0" max="100" step="5" value="0" style="width:76px" />
        <span class="muted">%</span>
      </div>

      <!-- ER и просмотры -->
      <div class="chip">
        <label>ER (последние 30 постов)</label>
        <input id="fErMin" type="number" placeholder="мин" min="0" step="0.1" style="width:90px" />
        <span class="muted">—</span>
        <input id="fErMax" type="number" placeholder="макс" min="0" step="0.1" style="width:90px" />
      </div>

      <div class="chip">
        <label>Views / post</label>
        <input id="fViewsMin" type="number" placeholder="мин" min="0" step="1000" style="width:120px" />
      </div>

      <!-- Цена -->
      <div class="chip">
        <label>Цена (integrated), USD</label>
        <input id="fPriceMin" type="number" placeholder="от" min="0" step="100" style="width:120px" />
        <span class="muted">—</span>
        <input id="fPriceMax" type="number" placeholder="до" min="0" step="100" style="width:120px" />
      </div>

      <!-- Прочее -->
      <div class="chip">
        <label>Язык автора</label>
        <select id="fLang">
          <option value="">Любой</option>
          <option value="ru">Русский</option>
          <option value="en">English</option>
        </select>
      </div>

      <div class="chip">
        <label>Страна автора</label>
        <select id="fCountry">
          <option value="">Любая</option>
          <option>RU</option><option>UA</option><option>KZ</option><option>BY</option><option>GE</option><option>TR</option>
        </select>
      </div>

      <div class="chip">
        <label>Contacts</label>
        <label class="switch"><input id="fHasEmail" type="checkbox" /><span>только с email</span></label>
      </div>

      <!-- AI-фильтры (дополнительные) -->
      <div class="chip">
        <label>Lookalikes</label>
        <input id="fSimilarTo" type="text" placeholder="похожие на…" style="width:180px" />
      </div>
      <div class="chip">
        <label class="switch"><input id="fTopER" type="checkbox" /><span>Top 25% по ER</span></label>
      </div>

      <!-- Поиск + сортировка -->
      <div class="chip">
        <label>Поиск</label>
        <input id="fQuery" type="search" placeholder="имя/ниша/теги…" />
      </div>

      <div class="chip">
        <label>Сортировка</label>
        <select id="fSortBy">
          <option value="followers">Подписчики</option>
          <option value="er">ER</option>
          <option value="views">Просмотры</option>
          <option value="price">Цена</option>
        </select>
        <select id="fSortDir">
          <option value="desc">по убыв.</option>
          <option value="asc">по возр.</option>
        </select>
      </div>

      <button id="clearFilters" class="btn btn-secondary" type="button" style="margin-left:auto">Очистить фильтры</button>
    </form>

    <!-- Активные чипы -->
    <div id="activeChips" class="chips"></div>

    <!-- Статистика + кнопки -->
    <div class="row" style="justify-content:space-between;margin:10px 0">
      <div class="muted">Результатов: <span id="resultsCount">0</span> · Выбрано: <span id="pickedCount">0</span></div>
      <div class="row">
        <button id="selectAll" class="btn btn-secondary" type="button">Выбрать все (фильтр)</button>
        <button id="clearPicked" class="btn btn-secondary" type="button">Очистить выбор</button>
      </div>
    </div>

    <!-- Результаты -->
    <ul id="resultsList" class="cards-list"></ul>
  </template>

  <!-- Шаг 2: Бриф -->
  <template id="tpl-2-brief">
    <h2>Бриф</h2>
    <form id="briefForm" class="grid">
      <div class="field" style="grid-column:1/-1">
        <label>Цель</label>
        <textarea id="briefGoal" rows="3" placeholder="Что хотим достичь…" required></textarea>
      </div>
      <div class="field">
        <label>Бюджет, ₽</label>
        <input id="briefBudget" type="number" min="1" required />
      </div>
      <div class="field">
        <label>Дедлайн</label>
        <input id="briefDeadline" type="date" required />
      </div>
      <div class="muted" id="briefSaved"></div>
      <button class="btn" type="submit">Сохранить бриф</button>
    </form>
  </template>

  <!-- Шаг 3: Привязка почты -->
  <template id="tpl-3-email">
    <h2>Привязка почты</h2>
    <div class="row">
      <input id="emailAccount" type="email" placeholder="[email protected]" style="max-width:320px" />
      <button id="linkEmailBtn" class="btn">Привязать</button>
      <span id="emailStatus" class="muted"></span>
    </div>
  </template>

  <!-- Шаг 4: Рассылка -->
  <template id="tpl-4-outreach">
    <h2>Рассылка</h2>
    <p class="muted">Выбранные на шаге 1 блогеры будут предложены получателями.</p>
    <div class="row">
      <button id="sendOutreachBtn" class="btn">Отправить письма</button>
      <span id="outreachStatus" class="muted"></span>
    </div>
    <h3 style="margin-top:16px">Кто ответил?</h3>
    <ul id="outreachList" class="list"></ul>
    <button id="markRespondBtn" class="btn btn-secondary">Отметить ответы</button>
  </template>

  <!-- Шаг 5: Договор -->
  <template id="tpl-5-contract">
    <h2>Договор</h2>
    <div class="row">
      <button id="signContractBtn" class="btn">Подписать</button>
      <span id="contractStatus" class="muted"></span>
    </div>
  </template>

  <!-- Шаг 6: Оплата -->
  <template id="tpl-6-payment">
    <h2>Оплата</h2>
    <div class="row">
      <button id="reserveFundsBtn" class="btn">Зарезервировать средства</button>
      <span id="paymentStatus" class="muted"></span>
    </div>
  </template>

  <!-- Шаг 7: Съёмка черновика -->
  <template id="tpl-7-shoot">
    <h2>Съёмка черновика</h2>
    <div class="row">
      <button id="uploadBtn" class="btn">Загрузить видео</button>
      <input id="uploadInput" type="file" accept="video/*" hidden />
      <span id="shootStatus" class="muted"></span>
    </div>
  </template>

  <!-- Шаг 8: Одобрение рекламы -->
  <template id="tpl-8-approval">
    <h2>Одобрение</h2>
    <div class="field">
      <label>Ссылка на ролик</label>
      <input id="approvalLink" type="url" placeholder="https://"/>
    </div>
    <div class="field">
      <label>Комментарий</label>
      <textarea id="approvalComment" rows="2" placeholder="Необязательно"></textarea>
    </div>
    <div class="row">
      <button id="approveBtn" class="btn">Принять</button>
      <button id="requestFixBtn" class="btn btn-secondary">Запросить правки</button>
      <span id="approvalStatus" class="muted"></span>
    </div>
  </template>

  <!-- Шаг 9: Выплата блогеру -->
  <template id="tpl-9-payout">
    <h2>Выплата блогеру</h2>
    <div id="payoutInfo" class="muted">Будет проведена автоматически после «Принять».</div>
  </template>
</body>
</html>
